<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Drop API | Drops Developers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" type="image/png" href="favicon.png"/>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">

    <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
  </head>


  <body data-spy="scroll" data-target="#affix-nav">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <div class="navbar navbar-default" role="navigation">
      <div class="container">
        <a class="navbar-brand" href="index.html">Drops Developers</a>
        <ul class="nav navbar-nav pull-right nav-pills">
          <li><a href="index.html">Home</a></li>
          <!-- <li><a href="get_started.html">Get started</a></li> -->
          <!-- <li><a href="android.html">Android</a></li> -->
          <li class="active"><a href="api.html">Drop API</a></li>
          <li><a href="tools.html">Tools</a></li>
        </ul>
      </div>
    </div>



    <div class="container">

      <div class="jumbotron row">
        <div class="col-sm-9">
          <h1>Drop API</h1>
          <p>
            Discover the Drop API to implement it in your project or better understand how it works. If you are developing for Android, it is recommended to use the official <a href="android.html">Android API</a>. Also make sure to read the <a href="get-started.html">Get started</a> section before this one, it will give you a general overview of the functioning of a Drop and how to communicate with it.
          </p>
        </div>
        <div class="col-sm-3">
          <img src="img/drop_board.png" alt="API" width="100%" />
        </div>
      </div>


      <div class="row">
        <div class="col-sm-9">
          <div class="page-header">
            <h2 id="overview">Overview</h2>
          </div>

          <p>
            Drops use Bluetooth Low Energy (BLE) to communicate with another device. If you are not familiar with the basics of BLE, check out the <a href="https://developer.bluetooth.org/TechnologyOverview/Pages/BLE.aspx">Bluetooth Developer Portal</a> first.
          </p>
          <p>
            The Drops advertise some data you can use to decide whether your application needs to connect or not, like the Drop Type which can help you to identify the drops compatible with your applocation. When you are connected to the drop, the advertising stops, so make sure to remain connected as least as possible. For more informations about this, check out the <a href="#advertising">Advertising section</a>.
          </p>
          <p>
            The Drops use one service (<em>Drop Service</em>) which contains three characteristics (<em>Message Commands</em>, <em>Box Commands</em> and <em>Drop Commands</em>). Each characteristic is used for writing a request and reading the response. Here are the steps to send a command and read its response:
            <ol>
              <li>Write the command in the appropriate characteristic.</li>
              <li>Wait for the ACK. After this, the drop starts processing your request.</li>
              <li>The drop notify the response on the same characteristic (only the first 20 bytes are notified).</li>
              <li>If the response is longer than 20 bytes, you might want to read the full characteristic.</li>
            </ol>
          </p>
          <div class="alert alert-danger"><i class="glyphicon glyphicon-warning-sign"></i> <strong>Warning!</strong> No request should be sent before the previous response notification has been received and acknowledged, even if the two requests are performed on different characteristics. The behaviour of the drop is not defined if you do not abide by this rule.</div>
          <p>
            Due to some hardware restrictions, it is currently impossible to use the Write Long Bluetooth feature. However, we have implemented a workaround to let devices write commands longer than 20 bytes. See <a href="#long-cmd">Long Commands section</a> to learn how to use it.
          </p>
          <p>
            Some commands also require the user to be authenticated as the administrator or as a user with priveleges. Check the <a href="#auth">Authentication section</a> for more informations about it.
          </p>


          <div class="page-header">
            <h2 id="advertising">Advertising</h2>

            <p class="lead">The Drops are advertising every 0.5 seconds. The advertising packet contains the default BLE advertising fields (like the Drop name), and also some informations about the drop in the manufacturer specific data.</p>
            <p>The manufacturer specific data field consists of 6 bytes organized like this:</p>

            <table class="table fields">
            <tr class="field-names">
              <td>Drop Type</td>
              <td colspan="2">Revision</td>
              <td colspan="3">Current timestamp</td>
              <td colspan="2">X</td>
            </tr>
            <tr class="binary">
              <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
            </tr>
            <tr class="hex">
              <td colspan="8">0x00</td>
            </tr>
          </table>

          <dl class="dl-horizontal">
            <dt>Drop Type</dt>
            <dd>Code used by the applications to identify the compatible drops.</dd>
            <dt>Revision</dt>
            <dd><span class="text-muted">Not yet used.</span></dd>
            <dt>Current timestamp</dt>
            <dd>Last timestamp registered by the drop.</dd>
            <dt>X</dt>
            <dd><span class="text-muted">Not used.</span></dd>
          </dl>


          </div>



          <div class="page-header">
            <h2 id="msg-cmd">Message Commands</h2>
          </div>

          <h3 id="fields-msg-cmd">Fields</h3>
          <p class="lead">The Message Commands contain this header (8 bytes) followed by an optional content (its length is given by the <em>Length/Error</em> field). Read the specific documentation of a command to know how to configure these fields.</p>

          <table class="table fields">
            <tr class="field-names">
              <td>LE [0]</td>
              <td colspan="6">Code</td>
              <td>S</td>
              <td colspan="8">LE [1..8]</td>
              <td colspan="3">X</td>
              <td colspan="5">Box ID</td>
              <td colspan="8">Message ID [0..8]</td>
              <td>-</td>
              <td colspan="7">Message ID [8..14]</td>
              <td colspan="8">Timestamp [0..7]</td>
              <td colspan="8">Timestamp [8..15]</td>
              <td colspan="8">Timestamp [16..23]</td>
            </tr>
            <tr class="binary">
              <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
            </tr>
            <tr class="hex">
              <td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td>
            </tr>
          </table>

          <dl class="dl-horizontal">
            <dt>Signed (S)</dt>
            <dd>Set to 1 if the command is signed (see <a href="#auth">Authentication section</a> for more informations).</dd>
            <dt>Code</dt>
            <dd>Code of the command to execute.</dd>
            <dt>Length/Error (LE)</dt>
            <dd>Length of the <em>Content</em> field. Set to <kbd>0x1ff</kbd> if an error occurs.</dd>
            <dt>Message ID</dt>
            <dd>ID of the message.</dd>
            <dt>Box ID</dt>
            <dd>ID of the box where the message is stored.</dd>
            <dt>Timeout</dt>
            <dd>Timeout of the message.</dd>
            <dt>X</dt>
            <dd><span class="text-muted">Not used.</span></dd>
          </dl>

          <hr />

          <h3 id="read-msg-cmd">Read Message</h3>

          <p class="lead">Read the message with the given ID in the given box.</p>

          <div class="alert alert-info"><i class="glyphicon glyphicon-lock"></i> <strong>Authentication</strong> This command supports authentication. It can be runned as authenticated user or as admin. See <a href="#auth">Authentication section</a> for more informations.</div>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd>Set to 1 if the command is signed (see <a href="#auth">Authentication section</a> for more informations).</dd>
            <dt>Code</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Length/Error</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Message ID</dt>
            <dd>Set to the message ID you want to read.</dd>
            <dt>Box ID</dt>
            <dd>Set to the box ID where the message is stored.</dd>
            <dt>Timeout</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Content</dt>
            <dd>Empty.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following fields are modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured. Length of the content in bytes otherwise.</dd>
            <dt>Timeout</dt>
            <dd>Timeout of the message.</dd>
            <dt>Content</dt>
            <dd>If an error occured, it contains the error code on 4 bytes. Otherwise, it contains the content of the message (check the <em>Length/Error</em> field to know the length of the content).</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x16</kbd></dt>
            <dd>Box not found.</dd>
            <dt><kbd>0x17</kbd></dt>
            <dd>Message not found.</dd>
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
            <dt><kbd>0x22</kbd></dt>
            <dd>Not authorized (perhaps do you need to sign your request?).</dd>
            <dt><kbd>0x35</kbd></dt>
            <dd>Bad signature.</dd>
          </dl>

          <hr />

          <h3 id="write-msg-cmd">Write Message</h3>

          <p class="lead">Create a new message in the given box.</p>

          <div class="alert alert-info"><i class="glyphicon glyphicon-lock"></i> <strong>Authentication</strong> This command supports authentication. It can be runned as authenticated user or as admin. See <a href="#auth">Authentication section</a> for more informations.</div>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd>Set to 1 if the command is signed (see <a href="#auth">Authentication section</a> for more informations).</dd>
            <dt>Code</dt>
            <dd><kbd>0x01</kbd></dd>
            <dt>Length/Error</dt>
            <dd>Length of the <em>Content</em> field in bytes (less than 500 bytes).</dd>
            <dt>Message ID</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Box ID</dt>
            <dd>Set to the box ID where the message is stored.</dd>
            <dt>Timeout</dt>
            <dd>Set the timeout of the message. Set to <kbd>0xffffff</kbd> for infinite timeout.</dd>
            <dt>Content</dt>
            <dd>Content of the message. It cannot be more than 500 bytes long.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following fields are modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd>Set to <kbd>0x1ff</kbd> if an error occured.</dd>
            <dt>Message ID</dt>
            <dd>ID of the created message.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x16</kbd></dt>
            <dd>Box not found.</dd>
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
            <dt><kbd>0x22</kbd></dt>
            <dd>Not authorized (perhaps do you need to sign your request?).</dd>
            <dt><kbd>0x35</kbd></dt>
            <dd>Bad signature.</dd>
          </dl>

          <hr />

          <h3 id="delete-msg-cmd">Delete Message</h3>

          <p class="lead">Delete the message with the given ID in the given box.</p>

          <div class="alert alert-info"><i class="glyphicon glyphicon-lock"></i> <strong>Authentication</strong> This command supports authentication. It can be runned as authenticated user or as admin. See <a href="#auth">Authentication section</a> for more informations.</div>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd>Set to 1 if the command is signed (see <a href="#auth">Authentication section</a> for more informations).</dd>
            <dt>Code</dt>
            <dd><kbd>0x02</kbd></dd>
            <dt>Length/Error</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Message ID</dt>
            <dd>Set to the message ID you want to delete.</dd>
            <dt>Box ID</dt>
            <dd>Set to the box ID where the message is stored.</dd>
            <dt>Timeout</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Content</dt>
            <dd>Empty.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured. Length of the content in bytes otherwise.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x16</kbd></dt>
            <dd>Box not found.</dd>
            <dt><kbd>0x17</kbd></dt>
            <dd>Message not found.</dd>
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
            <dt><kbd>0x22</kbd></dt>
            <dd>Not authorized (perhaps do you need to sign your request?).</dd>
            <dt><kbd>0x35</kbd></dt>
            <dd>Bad signature.</dd>
          </dl>

          <hr />

          <h3 id="edit-msg-cmd">Edit Message</h3>

          <p class="lead">Modify the message with the given ID in the given box.</p>

          <div class="alert alert-info"><i class="glyphicon glyphicon-lock"></i> <strong>Authentication</strong> This command supports authentication. It can be runned as authenticated user or as admin. See <a href="#auth">Authentication section</a> for more informations.</div>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd>Set to 1 if the command is signed (see <a href="#auth">Authentication section</a> for more informations).</dd>
            <dt>Code</dt>
            <dd><kbd>0x03</kbd></dd>
            <dt>Length/Error</dt>
            <dd>Length of the <em>Content</em> field in bytes (less than 500 bytes).</dd>
            <dt>Message ID</dt>
            <dd>Set to the message ID you want to modify.</dd>
            <dt>Box ID</dt>
            <dd>Set to the box ID where the message is stored.</dd>
            <dt>Timeout</dt>
            <dd>Set the timeout of the message. Set to <kbd>0xffffff</kbd> for infinite timeout.</dd>
            <dt>Content</dt>
            <dd>Content of the message. It cannot be more than 500 bytes long.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured. Length of the content in bytes otherwise.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x16</kbd></dt>
            <dd>Box not found.</dd>
            <dt><kbd>0x17</kbd></dt>
            <dd>Message not found.</dd>
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
            <dt><kbd>0x22</kbd></dt>
            <dd>Not authorized (perhaps do you need to sign your request?).</dd>
            <dt><kbd>0x35</kbd></dt>
            <dd>Bad signature.</dd>
          </dl>



          <div class="page-header">
            <h2 id="box-cmd">Box Commands</h2>
          </div>

          <h3 id="fields-box-cmd">Fields</h3>

          <p class="lead">The Box Commands contain this header (3 bytes) followed by an optional content (its length is given by the <em>Length/Error</em> field). Read the specific documentation of a command to know how to configure these fields.</p>

          <table class="table fields">
            <tr class="field-names">
              <td>LE [0]</td>
              <td colspan="6">Code</td>
              <td>S</td>
              <td colspan="8">LE [1..8]</td>
              <td colspan="3">X</td>
              <td colspan="5">Box ID</td>
            </tr>
            <tr class="binary">
              <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
            </tr>
            <tr class="hex">
              <td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td>
            </tr>
          </table>

          <dl class="dl-horizontal">
            <dt>Signed (S)</dt>
            <dd>Set to 1 if the command is signed (see <a href="#auth">Authentication section</a> for more informations).</dd>
            <dt>Code</dt>
            <dd>Code of the command to execute.</dd>
            <dt>Length/Error (LE)</dt>
            <dd>Length of the <em>Content</em> field. Set to <kbd>0x1ff</kbd> if an error occurs.</dd>
            <dt>Box ID</dt>
            <dd>ID of the box where the message is stored.</dd>
            <dt>X</dt>
            <dd><span class="text-muted">Not used.</span></dd>
          </dl>

          <hr />

          <h3 id="create-box-cmd">Create Box</h3>

          <p class="lead">Create a new box with the given ID.</p>

          <div class="alert alert-info"><i class="glyphicon glyphicon-lock"></i> <strong>Admin</strong> This command must be signed by the administrator. See <a href="#auth">Authentication section</a> for more informations.</div>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd><kbd>1</kbd></dd>
            <dt>Code</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Length/Error</dt>
            <dd><kbd>0x06</kbd></dd>
            <dt>Box ID</dt>
            <dd>Set to the ID of the box you want to create.</dd>
          </dl>

          <p>The <em>Content</em> field must contain the following parameters for the new box:</p>

          <table class="table fields">
            <tr class="field-names">
              <td colspan="8">Permissions</td>
              <td colspan="8">Box size [0..7]</td>
              <td colspan="4">Max message length [0..3]</td>
              <td colspan="4">Box size [8..11]</td>
              <td colspan="2">Delete mode</td>
              <td colspan="1">Flood mode</td>
              <td colspan="5">Max message length [4..8]</td>
              <td colspan="16">Box mask</td>
            </tr>
            <tr class="binary">
              <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
            </tr>
            <tr class="hex">
              <td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td><td colspan="8">0x00</td>
            </tr>
          </table>

          <!-- <div class="alert alert-danger">TODO: explain the fields!!</div> -->


          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
            <dt><kbd>0x22</kbd></dt>
            <dd>Not authorized (you must sign your request as admin).</dd>
            <dt><kbd>0x35</kbd></dt>
            <dd>Bad signature.</dd>
          </dl>


          <hr />

          <h3 id="delete-box-cmd">Delete Box</h3>

          <p class="lead">Delete the given box.</p>

          <div class="alert alert-info"><i class="glyphicon glyphicon-lock"></i> <strong>Admin</strong> This command must be signed by the administrator. See <a href="#auth">Authentication section</a> for more informations.</div>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd><kbd>1</kbd></dd>
            <dt>Code</dt>
            <dd><kbd>0x01</kbd></dd>
            <dt>Length/Error</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Box ID</dt>
            <dd>Set to the box ID you want to delete.</dd>
            <dt>Content</dt>
            <dd>Empty.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x16</kbd></dt>
            <dd>Box not found.</dd>
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
            <dt><kbd>0x22</kbd></dt>
            <dd>Not authorized (you must sign your request as admin).</dd>
            <dt><kbd>0x35</kbd></dt>
            <dd>Bad signature.</dd>
          </dl>

          <hr />

          <h3 id="ids-box-cmd">List Message IDs</h3>

          <p class="lead">List the IDs of the messages stored in the given box.</p>

          <div class="alert alert-warning"><i class="glyphicon glyphicon-exclamation-sign"></i> <strong>Warning!</strong> The list may contains IDs of messages whose timestamps have expired. If you need to be sure about the validity of a message, you have to explicitly read it.</div>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd><kbd>0</kbd></dd>
            <dt>Code</dt>
            <dd><kbd>0x02</kbd></dd>
            <dt>Length/Error</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Box ID</dt>
            <dd>Set to the box ID you want to list.</dd>
            <dt>Content</dt>
            <dd>Empty.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured. Length of the content in bytes otherwise.</dd>
            <dt>Content</dt>
            <dd>Contains the list of message IDs. Each ID is stored on 2 bytes.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x16</kbd></dt>
            <dd>Box not found.</dd>
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
          </dl>

          <!-- <hr />

          <h3 id="revs-box-cmd">List Message Revisions</h3>

          <div class="alert alert-warning">Not implemented yet.</div> -->



          <div class="page-header">
            <h2 id="drop-cmd">Drop Commands</h2>
          </div>

          <h3 id="fields-drop-cmd">Fields</h3>

          <p class="lead">The Drop Commands contain this header (2 bytes) followed by an optional content (its length is given by the <em>Length/Error</em> field). Read the specific documentation of a command to know how to configure these fields.</p>

          <table class="table fields">
            <tr class="field-names">
              <td>LE [0]</td>
              <td colspan="6">Code</td>
              <td>S</td>
              <td colspan="8">LE [1..8]</td>
            </tr>
            <tr class="binary">
              <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
            </tr>
            <tr class="hex">
              <td colspan="8">0x00</td><td colspan="8">0x00</td>
            </tr>
          </table>

          <dl class="dl-horizontal">
            <dt>Signed (S)</dt>
            <dd>Set to 1 if the command is signed (see <a href="#auth">Authentication section</a> for more informations).</dd>
            <dt>Code</dt>
            <dd>Code of the command to execute.</dd>
            <dt>Length/Error (LE)</dt>
            <dd>Length of the <em>Content</em> field. Set to <kbd>0x1ff</kbd> if an error occurs.</dd>
          </dl>

         <!--  <hr />

          <h3 id="timestamp-drop-cmd">Read/Edit Timestamp</h3> -->

          <hr />

          <h3 id="box-ids-drop-cmd">List Box IDs</h3>

          <p class="lead">List the IDs of the available boxes.</p>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd><kbd>0</kbd></dd>
            <dt>Code</dt>
            <dd><kbd>0x01</kbd></dd>
            <dt>Length/Error</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Content</dt>
            <dd>Empty.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured. Length of the content in bytes otherwise.</dd>
            <dt>Content</dt>
            <dd>Contains the list of box IDs. Each ID is stored on 1 byte.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
          </dl>

          <hr />

          <h3 id="drop-key-drop-cmd">Drop Public Key</h3>

          <p class="lead">Return the public key of the Drop.</p>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd><kbd>0</kbd></dd>
            <dt>Code</dt>
            <dd><kbd>0x02</kbd></dd>
            <dt>Length/Error</dt>
            <dd><kbd>0x00</kbd></dd>
            <dt>Content</dt>
            <dd>Empty.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured. <kbd>0x20</kbd> otherwise.</dd>
            <dt>Content</dt>
            <dd>The Drop public key (on 32 bytes).</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
          </dl>

          <hr />

          <h3 id="sign-drop-cmd">Sign</h3>

          <p class="lead">Sign the given content with the Drop private key.</p>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd><kbd>0</kbd></dd>
            <dt>Code</dt>
            <dd><kbd>0x03</kbd></dd>
            <dt>Length/Error</dt>
            <dd>Length of the <em>Content</em> field in bytes (less than 64 bytes).</dd>
            <dt>Content</dt>
            <dd>The content to sign. It cannot be more than 64 bytes long.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured. <kbd>0x20</kbd> otherwise.</dd>
            <dt>Content</dt>
            <dd>The signature of the given content (on 32 bytes).</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
          </dl>

          <!-- <hr />

          <h3 id="admin-key-drop-cmd">Read/Edit Admin Public Key</h3> -->

          <hr />

          <h3 id="reset-drop-cmd">Factory Reset</h3>

          <p class="lead">Reset the drop by removing all the boxes and all the messages. It can also revoke the Drop keys (a new key pair will be generated) and the administrator public key (the default admin key will be installed).</p>

          <div class="alert alert-danger"><i class="glyphicon glyphicon-warning-sign"></i> <strong>Use with caution!</strong> This command will erase all the boxes and messages stored in the box. There is no way to recover them after running this command. Also, depending on the parameters you give, this command may revoke the Drop keys and the administrator public key.</div>

          <div class="alert alert-warning"><i class="glyphicon glyphicon-exclamation-sign"></i> <strong>Warning!</strong> This command will disconnect your device instantly. Also this command takes up to 100 seconds to be performed. During the process, the led is on. Do not try to connect the drop while the led is on.</div>

          <div class="alert alert-info"><i class="glyphicon glyphicon-lock"></i> <strong>Admin</strong> This command must be signed by the administrator. See <a href="#auth">Authentication section</a> for more informations.</div>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd><kbd>1</kbd></dd>
            <dt>Code</dt>
            <dd><kbd>0x05</kbd></dd>
            <dt>Length/Error</dt>
            <dd><kbd>0x01</kbd></dd>
            <dt>Content</dt>
            <dd><kbd>0x00</kbd> to preserve the Drop and Admin keys.<br /><kbd>0x01</kbd> to reset the Drop keys and preserve the Admin key.<br /><kbd>0x02</kbd> to preserve the Drop keys and reset the Admin key.<br /><kbd>0x03</kbd> to reset the Drop and Admin keys.</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured.
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
            <dt><kbd>0x22</kbd></dt>
            <dd>Not authorized (you must sign your request as admin).</dd>
            <dt><kbd>0x35</kbd></dt>
            <dd>Bad signature.</dd>
          </dl>

          <hr />

          <h3 id="type-drop-cmd">Change Drop Type</h3>

          <p class="lead">Change the type of the Drop which will be advertised.</p>

          <div class="alert alert-info"><i class="glyphicon glyphicon-lock"></i> <strong>Admin</strong> This command must be signed by the administrator. See <a href="#auth">Authentication section</a> for more informations.</div>

          <h4><i class="glyphicon glyphicon-save"></i> Request</h4>
          <dl class="dl-horizontal">
            <dt>Signed</dt>
            <dd><kbd>1</kbd></dd>
            <dt>Code</dt>
            <dd><kbd>0x06</kbd></dd>
            <dt>Length/Error</dt>
            <dd><kbd>0x01</kbd></dd>
            <dt>Content</dt>
            <dd>The Drop type to advertise (on 1 byte).</dd>
          </dl>

          <h4><i class="glyphicon glyphicon-open"></i> Response</h4>
          <p>Only the following field is modified:</p>
          <dl class="dl-horizontal">
            <dt>Length/Error</dt>
            <dd><kbd>0x1ff</kbd> if an error occured.
          </dl>

          <h4><i class="glyphicon glyphicon-exclamation-sign"></i> Error codes</h4>
          <p>If an error occurs, the <em>Length/Error</em> field is set to <kbd>0x1ff</kbd> and the <em>Content</em> field contains one of the following error codes:</p>
          <dl class="dl-horizontal">
            <dt><kbd>0x1f</kbd></dt>
            <dd>Invalid length (check the syntax of your command).</dd>
            <dt><kbd>0x22</kbd></dt>
            <dd>Not authorized (you must sign your request as admin).</dd>
            <dt><kbd>0x35</kbd></dt>
            <dd>Bad signature.</dd>
          </dl>



          <div class="page-header">
            <h2 id="long-cmd">Long Commands</h2>
          </div>

          <p class="lead">
            Due to some hardware restrictions, it is currently impossible to use the Write Long Bluetooth feature. However, we have implemented a workaround to let devices write commands longer than 20 bytes. If the command is not longer than 20 bytes, no special behaviour is required. Otherwise, you must abide by the following rules.
          </p>

          <p>
            A Long Command must be split into 20 bytes chunks. The first chunk is not modified. The others must start with the index of the chunk (the index starts at 1 for the second chunk). Here is an example of a Long Command before and after splitting (the index is highlighted):
          </p>

          <pre>Before split:<br />071a010100ffffff000000020100000000000000000000000000000000deadbeef581c748ab1c7a725824ef3ba4d823626626c6120626c6120626c614fce49ca303d1794eb1ec75d876828b96745f456d74f84d114231d6e5fc89ec5ffff<br /><br />After split:<br />071a010100ffffff000000020100000000000000   &lt;-- 1st chunk, no index, 20 bytes of actual content<br /><strong>01</strong>000000000000000000deadbeef581c748ab1c7   &lt;-- 2nd chunk, index 01, 19 bytes of actual content<br /><strong>02</strong>a725824ef3ba4d823626626c6120626c612062   &lt;-- 3rd chunk, index 02, 19 bytes of actual content<br /><strong>03</strong>6c614fce49ca303d1794eb1ec75d876828b967   &lt;-- 4th chunk, index 03, 19 bytes of actual content<br /><strong>04</strong>45f456d74f84d114231d6e5fc89ec5ffff       &lt;-- 5th and last chunk, index 04, 19 bytes of actual content</pre>

          <p>
            Be careful with the following points:
            <ul>
              <li>The index is written is hexadecimal (the chunk after <kbd>09</kbd> is <kbd>0a</kbd>).</li>
              <li>No padding is required for the last chunk.</li>
              <li>A command which is exactly 20 bytes long <strong>does not</strong> need to be split.</li>
              <li>A command which is exactly 40 bytes long requires 2 chunks (and not a third empty one).</li>
              <li>If the command is signed, you must split your command <strong>after</strong> appending the signature. Also, given the length of a signature, all the signed commands are also Long Commands.</li>
              <li>If the sent index is not the one the Drop was expecting, it will return a <kbd>0x20</kbd> error.</li>
              <li>If anything else does not respect these rules, the Drop will return a <kbd>0x1f</kbd> error.</li>
            </ul>
          </p>



          <!-- <div class="page-header">
            <h2 id="auth">Authentication</h2>
          </div>

          <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium.</p> -->
        </div>


        <nav class="col-sm-3" id="affix-nav">
          <ul class="nav sidenav" data-spy="affix">
            <li class="active"><a href="#overview">Overview</a></li>
            <li><a href="#advertising">Advertising</a></li>
            <li>
              <a href="#msg-cmd">Message Commands</a>
              <ul class="nav">
                <li><a href="#fields-msg-cmd">Fields</a></li>
                <li><a href="#read-msg-cmd">Read Message</a></li>
                <li><a href="#write-msg-cmd">Write Message</a></li>
                <li><a href="#delete-msg-cmd">Delete Message</a></li>
                <li><a href="#edit-msg-cmd">Edit Message</a></li>
              </ul>
            </li>
            <li>
              <a href="#box-cmd">Box Commands</a>
              <ul class="nav">
                <li><a href="#fields-box-cmd">Fields</a></li>
                <li><a href="#create-box-cmd">Create Box</a></li>
                <li><a href="#delete-box-cmd">Delete Box</a></li>
                <li><a href="#ids-box-cmd">List Message IDs</a></li>
                <!-- <li><a href="#revs-box-cmd">List Message Revisions</a></li> -->
              </ul>
            </li>
            <li>
              <a href="#drop-cmd">Drop Commands</a>
              <ul class="nav">
                <li><a href="#fields-drop-cmd">Fields</a></li>
                <!-- <li><a href="#timestamp-drop-cmd">Read/Edit Timestamp</a></li> -->
                <li><a href="#box-ids-drop-cmd">List Box IDs</a></li>
                <li><a href="#drop-key-drop-cmd">Drop Public Key</a></li>
                <li><a href="#sign-drop-cmd">Sign</a></li>
                <!-- <li><a href="#admin-key-drop-cmd">Read/Edit Admin Public Key</a></li> -->
                <li><a href="#reset-drop-cmd">Factory Reset</a></li>
                <li><a href="#type-drop-cmd">Change Drop Type</a></li>
              </ul>
            </li>
            <li><a href="#long-cmd">Long Commands</a></li>
            <!-- <li><a href="#auth">Authentication</a></li> -->
          </ul>
        </nav>
      </div>
    </div>


    <hr>

    <footer>
      <p>Drops N' Roses - ROSE 2014 - Télécom ParisTech</p>
    </footer>



    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.0.min.js"><\/script>')</script>

    <script src="js/vendor/bootstrap.min.js"></script>

    <script src="js/main.js"></script>
  </body>
</html>
